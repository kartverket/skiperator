apiVersion: skiperator.kartverket.no/v1alpha1
kind: Application
metadata:
  name: no-app-same-namespace
spec:
  image: image
  port: 8080
  accessPolicy:
    outbound:
      rules:
        - application: doesnt-exist
status:
  conditions:
    - type: InternalRulesValid
      status: "False"
---
apiVersion: v1
kind: Event
reason: InvalidAccessPolicy
source:
  component: application-controller
involvedObject:
  apiVersion: skiperator.kartverket.no/v1alpha1
  kind: Application
  name: no-app-same-namespace
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: no-app-same-namespace
  labels:
    app.kubernetes.io/managed-by: skiperator
    application.skiperator.no/app: no-app-same-namespace
    application.skiperator.no/app-name: no-app-same-namespace
    application.skiperator.no/app-namespace: access-policy-ns
    skiperator.kartverket.no/controller: application
  annotations:
    argocd.argoproj.io/sync-options: Prune=false
  ownerReferences:
    - apiVersion: skiperator.kartverket.no/v1alpha1
      kind: Application
      name: no-app-same-namespace
      controller: true
      blockOwnerDeletion: true
spec:
  podSelector:
    matchLabels:
      app: no-app-same-namespace
  egress:
    - to:
        - podSelector:
            matchLabels:
              app: doesnt-exist
          namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: ($namespace)
  policyTypes:
    - Egress
---
apiVersion: skiperator.kartverket.no/v1alpha1
kind: Application
metadata:
  name: no-app-different-namespace
spec:
  image: image
  port: 8080
  accessPolicy:
    outbound:
      rules:
        - application: doesnt-exist-diff-ns
          namespace: non-existing
status:
  conditions:
    - type: InternalRulesValid
      status: "False"
---
apiVersion: v1
kind: Event
reason: InvalidAccessPolicy
source:
  component: application-controller
involvedObject:
  apiVersion: skiperator.kartverket.no/v1alpha1
  kind: Application
  name: no-app-different-namespace
---
apiVersion: skiperator.kartverket.no/v1alpha1
kind: Application
metadata:
  name: no-namespace-with-labels
spec:
  image: image
  port: 8080
  accessPolicy:
    outbound:
      rules:
        - namespacesByLabel:
            test: dontexist
          application: access-policy-other
status:
  conditions:
    - type: InternalRulesValid
      status: "False"

---
apiVersion: v1
kind: Event
reason: InvalidAccessPolicy
source:
  component: application-controller
involvedObject:
  apiVersion: skiperator.kartverket.no/v1alpha1
  kind: Application
  name: no-namespace-with-labels
